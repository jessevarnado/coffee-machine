/*! coffee-machine 0.0.3 */
(function(){var a,b,c={}.hasOwnProperty,d=[].slice;b="undefined"!=typeof exports&&null!==exports?exports:window,b.CoffeeMachine=a=function(){function a(a){this.stateMachine=null!=a?a:{states:{},events:{}},this.defineStateMachine(this.stateMachine)}return a.prototype.defineStateMachine=function(a){var b,e,f,g,h,i,j,k,l,m,n,o=this;if(this.stateMachine=null!=a?a:{states:{},events:{}},-1!==this.stateMachine.states.constructor.toString().indexOf("Array"))for(i=this.stateMachine.states,this.stateMachine.states={},j=0,k=i.length;k>j;j++)g=i[j],this.stateMachine.states[g]={active:g===i[0]};if(b=function(){var a,b;a=this.stateMachine.states,b=[];for(g in a)c.call(a,g)&&(h=a[g],h.active&&b.push(g));return b}.call(this),0===b.length){l=this.stateMachine.states;for(g in l)if(c.call(l,g)){h=l[g],h.active=!0;break}}else if(b.length>1)for(g in b)c.call(b,g)&&g!==b[0]&&(h.active=!1);m=this.stateMachine.events,n=[];for(e in m)f=m[e],n.push(function(a,b){return o[a]=function(){return this.changeState.apply(this,[b.from,b.to,a].concat(d.call(arguments)))}}(e,f));return n},a.prototype.currentState=function(){var a,b;return function(){var d,e;d=this.stateMachine.states,e=[];for(a in d)c.call(d,a)&&(b=d[a],b.active&&e.push(a));return e}.call(this)[0]},a.prototype.availableStates=function(){var a,b,d;b=this.stateMachine.states,d=[];for(a in b)c.call(b,a)&&d.push(a);return d},a.prototype.availableEvents=function(){var a,b,d;b=this.stateMachine.events,d=[];for(a in b)c.call(b,a)&&d.push(a);return d},a.prototype.changeState=function(){var a,b,c,e,f,g,h,i,j,k,l;if(g=arguments[0],j=arguments[1],e=arguments[2],b=4<=arguments.length?d.call(arguments,3):[],null==e&&(e=null),-1!==g.constructor.toString().indexOf("Array")){if(-1===g.indexOf(this.currentState()))throw"Cannot change from states "+g.join(" or ")+"; none are the active state!";g=this.currentState()}if("any"===g&&(g=this.currentState()),h=this.stateMachine.states[g],k=this.stateMachine.states[j],void 0===k)throw"Cannot change to state '"+j+"'; it is undefined!";if(void 0===h)throw"Cannot change from state '"+g+"'; it is undefined!";if(h.active!==!0)throw"Cannot change from state '"+g+"'; it is not the active state!";return c=k.onEnter,i=k.guard,f=h.onExit,l={from:g,to:j,event:e},a=[l].concat(d.call(b)),void 0!==i&&i.apply(this,a)===!1?!1:(void 0!==f&&f.apply(this,a),void 0!==c&&c.apply(this,a),void 0!==this.stateMachine.onStateChange&&this.stateMachine.onStateChange.apply(this,a),h.active=!1,k.active=!0)},a}()}).call(this);